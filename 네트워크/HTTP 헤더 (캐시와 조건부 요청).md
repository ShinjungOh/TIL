# μΊμ‹μ™€ μ΅°κ±΄λ¶€ μ”μ²­

## 1. μΊμ‹ κΈ°λ³Έ λ™μ‘

### μΊμ‹κ°€ μ—†μ„ λ•
* λ°μ΄ν„°κ°€ λ³€κ²½λμ§€ μ•μ•„λ„ κ³„μ† λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄μ„ λ°μ΄ν„°λ¥Ό λ‹¤μ΄λ΅λ“ λ°›μ•„μ•Ό ν•λ‹¤. 
* μΈν„°λ„· λ„¤νΈμ›ν¬λ” λ§¤μ° λλ¦¬κ³  λΉ„μ‹Έλ‹¤. 
* λΈλΌμ°μ € λ΅λ”© μ†λ„κ°€ λλ¦¬λ‹¤. 
* λλ¦° μ‚¬μ©μ κ²½ν—

<br>

### μΊμ‹ μ μ©
* μΊμ‹ λ•λ¶„μ— μΊμ‹ κ°€λ¥ μ‹κ°„λ™μ• λ„¤νΈμ›ν¬λ¥Ό μ‚¬μ©ν•μ§€ μ•μ•„λ„ λλ‹¤. 
* λΉ„μ‹Ό λ„¤νΈμ›ν¬ μ‚¬μ©λ‰μ„ μ¤„μΌ μ μλ‹¤.
* λΈλΌμ°μ € λ΅λ”© μ†λ„κ°€ λ§¤μ° λΉ λ¥΄λ‹¤.
* λΉ λ¥Έ μ‚¬μ©μ κ²½ν—


    HTTP/1.1 200 OK 
    Content-Type: image/jpeg
    β­οΈcache-control: max-age=60
    Content-Length: 34012

    lkj123kljoiasudlkjaweioluywlnfdo912u34ljko98udjkla 
    slkjdfl;qkawj9;o4ruawsldkal;skdjfa;ow9ejkl3123123

<strong>οΈcache-control : μΊμ‹κ°€ μ ν¨ν• μ‹κ°„(μ΄)</strong>

<br>

1. μ²« λ²μ§Έ μ”μ²­ : μ‘λ‹µ κ²°κ³Όλ¥Ό μΊμ‹μ— μ €μ¥
2. λ‘ λ²μ§Έ μ”μ²­ : μΊμ‹ μ ν¨ μ‹κ°„ κ²€μ¦ -> μΊμ‹μ—μ„ μ΅°ν
3. μ„Έ λ²μ§Έ μ”μ²­ - μΊμ‹ μ‹κ°„ μ΄κ³Ό : μΊμ‹ μ ν¨ μ‹κ°„ κ²€μ¦ -> μ‘λ‹µ κ²°κ³Όλ¥Ό λ‹¤μ‹ μΊμ‹μ— μ €μ¥

<br>

### μΊμ‹ μ‹κ°„ μ΄κ³Ό
* μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•λ©΄, μ„λ²„λ¥Ό ν†µν•΄ λ°μ΄ν„°λ¥Ό λ‹¤μ‹ μ΅°νν•κ³ , μΊμ‹λ¥Ό κ°±μ‹ ν•λ‹¤. 
* μ΄λ• λ‹¤μ‹ λ„¤νΈμ›ν¬ λ‹¤μ΄λ΅λ“κ°€ λ°μƒν•λ‹¤.

<br><br>

---


## 2. κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­1

### μΊμ‹ μ‹κ°„ μ΄κ³Ό
μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•΄μ„ μ„λ²„μ— λ‹¤μ‹ μ”μ²­ν•λ©΄ λ‹¤μ λ‘ κ°€μ§€ μƒν™©μ΄ λ‚νƒ€λ‚λ‹¤. 
1. μ„λ²„μ—μ„ κΈ°μ΅΄ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•¨ π’› -> π’
2. μ„λ²„μ—μ„ κΈ°μ΅΄ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•μ§€ μ•μ π’›

<br>

### κ²€μ¦ ν—¤λ” μ¶”κ°€
* μΊμ‹ λ§λ£ν›„μ—λ„ μ„λ²„μ—μ„ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•μ§€ μ•μ π’›
* μƒκ°ν•΄λ³΄λ©΄ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ” λ€μ‹ μ— μ €μ¥ν•΄ λ‘μ—λ μΊμ‹λ¥Ό μ¬μ‚¬μ©ν•  μ μλ‹¤.
* λ‹¨ ν΄λΌμ΄μ–ΈνΈμ λ°μ΄ν„°μ™€ μ„λ²„μ λ°μ΄ν„°κ°€ <u>κ°™λ‹¤λ” μ‚¬μ‹¤μ„ ν™•μΈν•  μ μλ” λ°©λ²•</u> ν•„μ”

    
    HTTP/1.1 200 OK
    Content-Type: image/jpeg
    cache-control: max-age=60 
    β­οΈLast-Modified: 2020λ…„ 11μ›” 10μΌ 10:00:00
    Content-Length: 34012
    
    lkj123kljoiasudlkjaweioluywlnfdo912u34ljko98udjklasl 
    kjdfl;qkawj9;o4ruawsldkal;skdjfa;ow9ejkl3123123

<strong>Last-Modified(κ²€μ¦ ν—¤λ”) : λ°μ΄ν„°κ°€ λ§μ§€λ§‰μ— μμ •λ μ‹κ°„</strong>

<br>

![](../Images/κ²€μ¦ν—¤λ”μ¶”κ°€1.png) 
![](../Images/κ²€μ¦ν—¤λ”μ¶”κ°€2.png)
![](../Images/κ²€μ¦ν—¤λ”μ¶”κ°€3.png)

1. μ²« λ²μ§Έ μ”μ²­ : μ‘λ‹µ κ²°κ³Όλ¥Ό μΊμ‹μ— μ €μ¥
2. λ‘ λ²μ§Έ μ”μ²­ - μΊμ‹ μ‹κ°„ μ΄κ³Ό : 
   1. μΊμ‹κ°€ κ°€μ§€κ³  μλ”, λ°μ΄ν„° μµμΆ… μμ •μΌ λ‹΄μ•„ μ”μ²­
   2. μ„λ²„μ λ°μ΄ν„° μµμΆ… μμ •μΌκ³Ό λΉ„κµ κ²€μ¦ 
   3. HTTP Bodyμ μ™Έ, ν—¤λ”λ§ μ „μ†΅
   4. μ‘λ‹µ κ²°κ³Όλ¥Ό μ¬μ‚¬μ©, ν—¤λ” λ°μ΄ν„° κ°±μ‹  
   5. μΊμ‹μ—μ„ μ΅°ν

    
    <2-1>
    GET /star.jpg
    if-modified-since: 2020λ…„ 11μ›” 10μΌ 10:00:00

<strong>if-modified-since(μ΅°κ±΄λ¶€ μ”μ²­)</strong>


    <2-3>
    HTTP/1.1 β­οΈ304 Not Modified
    Content-Type: image/jpeg
    cache-control: max-age=60 
    Last-Modified: 2020λ…„ 11μ›” 10μΌ 10:00:00 
    Content-Length: 34012

304 Not Modified, HTTP Body μ „μ†΅X    

<br>

### κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­ μ •λ¦¬

* μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•΄λ„, μ„λ²„μ λ°μ΄ν„°κ°€ κ°±μ‹ λμ§€ μ•μΌλ©΄
* 304 Not Modified + ν—¤λ” λ©”νƒ€ μ •λ³΄λ§ μ‘λ‹µ (λ°”λ””X)
* ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„κ°€ λ³΄λ‚Έ μ‘λ‹µ ν—¤λ” μ •λ³΄λ΅ μΊμ‹μ λ©”νƒ€ μ •λ³΄λ¥Ό κ°±μ‹  
* ν΄λΌμ΄μ–ΈνΈλ” μΊμ‹μ— μ €μ¥λμ–΄ μλ” λ°μ΄ν„° μ¬ν™μ©
* κ²°κ³Όμ μΌλ΅ λ„¤νΈμ›ν¬ λ‹¤μ΄λ΅λ“κ°€ λ°μƒν•μ§€λ§, μ©λ‰μ΄ μ μ€ ν—¤λ” μ •λ³΄λ§ λ‹¤μ΄λ΅λ“ 
* λ§¤μ° μ‹¤μ©μ μΈ ν•΄κ²°μ±…

<br><br>

---


## 3. κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­2

### κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­
* <strong>κ²€μ¦ ν—¤λ”</strong>
  * μΊμ‹ λ°μ΄ν„°μ™€ μ„λ²„ λ°μ΄ν„°κ°€ κ°™μ€μ§€ κ²€μ¦ν•λ” λ°μ΄ν„°
  * Last-Modified , ETag


* <strong>μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”</strong>
  * κ²€μ¦ ν—¤λ”λ΅ μ΅°κ±΄μ— λ”°λ¥Έ λ¶„κΈ° 
  * If-Modified-Since : Last-Modified μ‚¬μ© 
  * If-None-Match : ETag μ‚¬μ©
  * μ΅°κ±΄μ΄ λ§μ΅±ν•λ©΄ 200 OK
  * μ΅°κ±΄μ΄ λ§μ΅±ν•μ§€ μ•μΌλ©΄ 304 Not Modified

<br>

### μμ‹

* If-Modified-Since: μ΄ν›„μ— λ°μ΄ν„°κ°€ μμ •λμ—μΌλ©΄?


* <strong>λ°μ΄ν„° λ―Έλ³€κ²½ μμ‹</strong>
    * μΊμ‹: 2020λ…„ 11μ›” 10μΌ 10:00:00 vs μ„λ²„: 2020λ…„ 11μ›” 10μΌ 10:00:00 
    * <strong>304 Not Modified</strong> (λ„μ μΊμ‹λ΅ λ¦¬λ‹¤μ΄λ ‰μ…ν•΄λΌ), ν—¤λ” λ°μ΄ν„°λ§ μ „μ†΅(BODY λ―Έν¬ν•¨)
    * μ „μ†΅ μ©λ‰ 0.1M (ν—¤λ” 0.1M, λ°”λ”” 1.0M)


  * <strong>λ°μ΄ν„° λ³€κ²½ μμ‹</strong>
    * μΊμ‹: 2020λ…„ 11μ›” 10μΌ 10:00:00 vs μ„λ²„: 2020λ…„ 11μ›” 10μΌ <u>11</u>:00:00 
    * <strong>200 OK</strong> (μμ •μ΄ λμ—λ‹¤), λ¨λ“  λ°μ΄ν„° μ „μ†΅(BODY ν¬ν•¨)
    * μ „μ†΅ μ©λ‰ 1.1M (ν—¤λ” 0.1M, λ°”λ”” 1.0M)

<br>

### Last-Modified, If-Modified-Since λ‹¨μ 
* 1μ΄ λ―Έλ§(0.xμ΄) λ‹¨μ„λ΅ μΊμ‹ μ΅°μ •μ΄ λ¶κ°€λ¥
* λ‚ μ§ κΈ°λ°μ λ΅μ§ μ‚¬μ©
* λ°μ΄ν„°λ¥Ό μμ •ν•΄μ„ λ‚ μ§κ°€ λ‹¤λ¥΄μ§€λ§, κ°™μ€ λ°μ΄ν„°λ¥Ό μμ •ν•΄μ„ λ°μ΄ν„° κ²°κ³Όκ°€ λ‘κ°™μ€ κ²½μ° (μ‹¤μ  μ½ν…μΈ λ” λ™μΌ) 
* μ„λ²„μ—μ„ λ³„λ„μ μΊμ‹ λ΅μ§μ„ κ΄€λ¦¬ν•κ³  μ‹¶μ€ κ²½μ°
  * <em>Ex) μ¤νμ΄μ¤λ‚ μ£Όμ„μ²λΌ ν¬κ² μν–¥μ΄ μ—†λ” λ³€κ²½μ—μ„ μΊμ‹λ¥Ό μ μ§€ν•κ³  μ‹¶μ€ κ²½μ°</em>

<br>

### ETag, If-None-Match
* ETag(Entity Tag)
* μΊμ‹μ© λ°μ΄ν„°μ— μ„μμ κ³ μ ν• λ²„μ „ μ΄λ¦„μ„ λ‹¬μ•„λ‘ 
  * <em>Ex) ETag: "v1.0", ETag: "a2jiodwjekjl3"</em>
* λ°μ΄ν„°κ°€ λ³€κ²½λλ©΄ μ΄ μ΄λ¦„μ„ λ°”κΎΈμ–΄μ„ λ³€κ²½ν•¨(Hashλ¥Ό λ‹¤μ‹ μƒμ„±)
  * <em>Ex) ETag: "aaaaa" -> ETag: "bbbbb"</em>
* μ§„μ§ λ‹¨μν•κ² ETagλ§ λ³΄λ‚΄μ„ κ°™μΌλ©΄ μ μ§€, λ‹¤λ¥΄λ©΄ λ‹¤μ‹ λ°›κΈ°!

<br>

### ETag, If-None-Match μ •λ¦¬
* λ‹¨μν•κ² ETagλ§ μ„λ²„μ— λ³΄λ‚΄μ„ κ°™μΌλ©΄ μ μ§€, λ‹¤λ¥΄λ©΄ λ‹¤μ‹ λ°›κΈ°
* <strong>μΊμ‹ μ μ–΄ λ΅μ§μ„ μ„λ²„μ—μ„ μ™„μ „ν κ΄€λ¦¬</strong>
* ν΄λΌμ΄μ–ΈνΈλ” λ‹¨μν μ΄ κ°’μ„ μ„λ²„μ— μ κ³µ(ν΄λΌμ΄μ–ΈνΈλ” μΊμ‹ λ©”μ»¤λ‹μ¦μ„ λ¨λ¦„)
* <em>Ex)
  * μ„λ²„λ” λ°°νƒ€ μ¤ν” κΈ°κ°„μΈ 3μΌ λ™μ• νμΌμ΄ λ³€κ²½λμ–΄λ„ ETagλ¥Ό λ™μΌν•κ² μ μ§€ 
  * μ• ν”λ¦¬μΌ€μ΄μ… λ°°ν¬ μ£ΌκΈ°μ— λ§μ¶”μ–΄ ETag λ¨λ‘ κ°±μ‹ </em>

<br><br>

---


## 4. μΊμ‹μ™€ μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”

### μΊμ‹ μ μ–΄ ν—¤λ”
* Cache-Control : μΊμ‹ μ μ–΄ 
* Pragma : μΊμ‹ μ μ–΄(ν•μ„ νΈν™) 
* Expires : μΊμ‹ μ ν¨ κΈ°κ°„(ν•μ„ νΈν™)

<br>

### Cache-Control 
<strong>μΊμ‹ μ§€μ‹μ–΄(directives)</strong>

* Cache-Control : max-age
  * μΊμ‹ μ ν¨ μ‹κ°„, μ΄ λ‹¨μ„
* Cache-Control : no-cache
  * λ°μ΄ν„°λ” μΊμ‹ν•΄λ„ λμ§€λ§, ν•­μƒ μ›(origin) μ„λ²„μ— κ²€μ¦ν•κ³  μ‚¬μ©
* Cache-Control : no-store
  * λ°μ΄ν„°μ— λ―Όκ°ν• μ •λ³΄κ°€ μμΌλ―€λ΅ μ €μ¥ν•λ©΄ μ•λ¨ (λ©”λ¨λ¦¬μ—μ„ μ‚¬μ©ν•κ³  μµλ€ν• λΉ¨λ¦¬ μ‚­μ )

<br>

### Pragma
<strong>μΊμ‹ μ μ–΄(ν•μ„ νΈν™)</strong>

* Pragma: no-cache 
* HTTP 1.0 ν•μ„ νΈν™ - μ§€κΈμ€ κ±°μ μ‚¬μ©ν•μ§€ μ•μ

<br>

### Expires
<strong>μΊμ‹ λ§λ£μΌ μ§€μ •(ν•μ„ νΈν™)</strong>
>expires: Mon, 01 Jan 1990 00:00:00 GMT

* μΊμ‹ λ§λ£μΌμ„ μ •ν™•ν• λ‚ μ§λ΅ μ§€μ •
* HTTP 1.0 λ¶€ν„° μ‚¬μ©
* μ§€κΈμ€ λ” μ μ—°ν• Cache-Control: max-age κ¶μ¥ (μ΄ λ‹¨μ„κ°€ λ” μ μ—°)
* Cache-Control: max-ageμ™€ ν•¨κ» μ‚¬μ©ν•λ©΄ Expiresλ” λ¬΄μ‹

<br>

### κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”
* <strong>κ²€μ¦ ν—¤λ” (Validator)</strong>
  * <strong>ETag</strong>: "v1.0", <strong>ETag</strong>: "asid93jkrh2l"
  * <strong>Last-Modified</strong>: Thu, 04 Jun 2020 07:19:24 GMT 
* <strong>μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”</strong>
  * If-Match, If-None-Match: ETag κ°’ μ‚¬μ©
  * If-Modified-Since, If-Unmodified-Since: Last-Modified κ°’ μ‚¬μ©

<br><br>

---


## 5. ν”„λ΅μ‹ μΊμ‹

### ν”„λ΅μ‹ μΊμ‹ λ„μ…

![](../Images/ν”„λ΅μ‹_μΊμ‹_λ„μ….png)

<br>

### Cache-Control 
<strong>μΊμ‹ μ§€μ‹μ–΄(directives) - κΈ°νƒ€</strong>

* <strong>Cache-Control : public</strong>
  * μ‘λ‹µμ΄ public μΊμ‹μ— μ €μ¥λμ–΄λ„ λ¨ 
* <strong>Cache-Control : private</strong>
  * μ‘λ‹µμ΄ ν•΄λ‹Ή μ‚¬μ©μλ§μ„ μ„ν• κ²ƒμ„, private μΊμ‹μ— μ €μ¥ν•΄μ•Ό ν•¨(κΈ°λ³Έκ°’) 
* <strong>Cache-Control : s-maxage</strong>
  * ν”„λ΅μ‹ μΊμ‹μ—λ§ μ μ©λλ” max-age 
* <strong>Age : 60 (HTTP ν—¤λ”)</strong>
  * μ¤λ¦¬μ§„ μ„λ²„μ—μ„ μ‘λ‹µ ν›„ ν”„λ΅μ‹ μΊμ‹ λ‚΄μ— λ¨Έλ¬Έ μ‹κ°„(μ΄)
  
<br><br>

---


## 6. μΊμ‹ λ¬΄ν¨ν™”

### Cache-Control
<strong>ν™•μ‹¤ν• μΊμ‹ λ¬΄ν¨ν™” μ‘λ‹µ</strong>

* <strong>Cache-Control: no-cache, no-store, must-revalidate 
* Pragma: no-cache</strong> 
  * HTTP 1.0 ν•μ„ νΈν™
* μ›ΉλΈλΌμ°μ €κ°€ μ„μλ΅ μΊμ‹ν•λ” κ²ƒμ„ λ°©μ§€

<br>

### Cache-Control
<strong>μΊμ‹ μ§€μ‹μ–΄(directives) - ν™•μ‹¤ν• μΊμ‹ λ¬΄ν¨ν™”</strong>

* <strong>Cache-Control: no-cache</strong>
  * λ°μ΄ν„°λ” μΊμ‹ν•΄λ„ λμ§€λ§, ν•­μƒ <strong>μ› μ„λ²„μ— κ²€μ¦</strong>ν•κ³  μ‚¬μ©(μ΄λ¦„μ— μ£Όμ!) 
* <strong>Cache-Control: no-store</strong>
  * λ°μ΄ν„°μ— λ―Όκ°ν• μ •λ³΄κ°€ μμΌλ―€λ΅ μ €μ¥ν•λ©΄ μ•λ¨β€¨ (λ©”λ¨λ¦¬μ—μ„ μ‚¬μ©ν•κ³  μµλ€ν• λΉ¨λ¦¬ μ‚­μ )
* <strong>Cache-Control: must-revalidate</strong>
  * μΊμ‹ λ§λ£ν›„ μµμ΄ μ΅°νμ‹ <strong>μ› μ„λ²„μ— κ²€μ¦</strong>ν•΄μ•Όν•¨
  * μ› μ„λ²„ μ ‘κ·Ό μ‹¤ν¨μ‹ λ°λ“μ‹ μ¤λ¥κ°€ λ°μƒν•΄μ•Όν•¨ - 504(Gateway Timeout) 
  * must-revalidateλ” μΊμ‹ μ ν¨ μ‹κ°„μ΄λΌλ©΄ μΊμ‹λ¥Ό μ‚¬μ©ν•¨
  * <em>Ex) ν†µμ¥ μ”κ³ </em>
* <strong>Pragma: no-cache</strong>
  * HTTP 1.0 ν•μ„ νΈν™

<br>

### no-cache vs must-revalidate

<strong>no-cache</strong>

![](../Images/no-cache_κΈ°λ³Έλ™μ‘1.png)
![](../Images/no-cache_κΈ°λ³Έλ™μ‘2.png)

<br>

<strong>must-revalidate</strong>

![](../Images/must-revalidate.png)
