# 쿠키, 세션

## HTTP의 특징

기본적으로 HTTP 프로토콜 환경은 `connectionless, stateless`한 특성을 가짐  
-> 서버는 클라이언트가 누구인지 매번 확인해야 함  
=> 이 특성을 보완하기 위해서 **쿠키와 세션**을 사용  

<br>

### 비연결성 connectionless

클라이언트가 서버에 request를 요청을 한 후 response 응답을 받으면 그 연결을 끊어 버리는 특징이 존재   
서버는 연결을 유지하지 않음으로써, 최소한의 자원을 유지

* HTTP는 기본이 연결을 **유지하지 않는** 모델
* 일반적으로 초 단위의 이하의 빠른 속도로 응답
* 서버 자원을 매우 효율적으로 사용할 수 있음

<br>

### 무상태 stateless

통신이 끝나면 상태를 유지하지 않는 특징  
연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며, 상태 정보는 유지하지 않음 

* 서버가 클라이언트의 상태를 보존하지 않기 때문에 아무 서버나 호출해도 됨
* 응답 서버를 쉽게 바꿀 수 있음 => 무한한 서버 증설 가능
* 장점 : 서버 확장성 높음 (스케일 아웃 - 수평 확장 유리)
* 단점 : 클라이언트가 추가 데이터 전송 (필요한 데이터 다 담아 보냄)

#### 상태 유지 Stateful

서버가 클라이언트의 상태를 보존하기 때문에, 항상 같은 서버가 유지되어야 함   
-> 서버를 늘리기 어려움   
-> 중간에 서버가 오류나면 처음부터 다시 진행해야 함  

<br><br>

## 쿠키와 세션을 사용하는 이유

HTTP 프로토콜의 특성이자 약점을 보완하기 위해서 쿠키, 세션을 사용

> 🍀 쿠키와 세션은 이 두 가지 특징을 해결하기 위해 사용
> 
> 쿠키와 세션을 사용하지 않으면, 쇼핑몰에 로그인을 했어도, 페이지를 이동할 때 마다 계속 로그인을 해야 함  
> 쿠키와 세션을 사용하면, 한 번 로그인을 하면 어떠한 방식에 의해서 그 사용자에 대한 인증을 유지하게 됨

<br><br>

## 쿠키 (Cookie)

쿠키는 클라이언트(브라우저) 로컬에 저장되는 키와 값이 들어있는 작은 데이터 파일  
서버가 사용자의 브라우저에 전송하는 작은 데이터 조각  
쿠키는 클라이언트의 상태 정보를 로컬에 저장했다가 참조(동일한 서버에 재요청 시 저장된 데이터를 함께 전송)  

* 사용자 인증이 유효한 시간을 명시할 수 있으며, 유효 시간(duration)이 정해지면 브라우저가 종료되어도 인증이 유지됨  
* 클라이언트에 300개까지 쿠키저장 가능
* 하나의 도메인당 20개의 값만 가질 수 있음
* 하나의 쿠키값은 4KB까지 저장 
* 서버는 응답과 함께 Response Header에 `Set-Cookie` 속성을 사용하면 클라이언트에 쿠키를 만들 수 있음 
* 쿠키는 사용자가 따로 요청하지 않아도 브라우저가 Request시에 Request Header를 넣어서 자동으로 서버에 전송
  
```
Set-Cookie: <cookie-name>=<cookie-value>
```

<br>

### 쿠키의 구성 요소

* 이름 : 각각의 쿠키를 구별할 때 사용되는 이름
* 값 : 쿠키의 이름과 관련된 값
* 유효시간 : 쿠키의 유지시간
* 도메인 : 쿠키를 전송할 도메인
* 경로 : 쿠키를 전송할 요청 경로

<br>

### 쿠키의 동작 방식

1. 클라이언트가 페이지를 요청
2. **서버**에서 쿠키를 생성 
3. HTTP 헤더에 쿠키를 포함시켜 응답 
4. 브라우저가 종료되어도 쿠키 **만료 기간**이 있다면 클라이언트에서 보관하고 있음 
5. 같은 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보냄 
6. 서버에서 쿠키를 읽어, 이전 상태 정보를 변경할 필요가 있을 때 쿠키를 업데이트하고 변경된 쿠키를 HTTP 헤더에 포함시켜 응답

<br>

### 쿠키의 사용 예시 

쿠키는 주로 세 가지 목적을 위해 사용

1. 세션 관리(Session management) : 서버에 저장해야 할 로그인, 장바구니, 게임 스코어 등의 정보 관리
2. 개인화(Personalization) : 사용자 선호, 테마 등의 세팅
3. 트래킹(Tracking) : 사용자 행동을 기록하고 분석하는 용도

* 자동 로그인, 사이트에서 로그인 시 "아이디와 비밀번호를 저장하시겠습니까?"
* 팝업에서 "오늘 더 이상 이 창을 보지 않음" 체크
* 쇼핑몰의 장바구니 기능

<br><br>

## 참고 사이트 

> https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies  
> https://developer.mozilla.org/ko/docs/Web/HTTP/Session  
> https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Connection  
> https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Keep-Alive  
> https://interconnection.tistory.com/74
