# 브라우저 렌더링

## 브라우저 렌더링 최적화

### 1. 웹페이지 로딩 최적화

#### 블록 리소스(CSS, 자바스크립트) 최적화

* CSS 최적화 : CSSOM 트리는 CSS를 모두 해석해야 구성되므로, 구성되지 않으면 렌더링이 차단됨 -> 이를 방지하기 위해 최적화를 시도
  * CSS는 항상 HTML 문서 최상단의 `<head>` 태그에 배치
  * 특정 조건이 필요한 CSS가 있을 때는 **미디어 쿼리**를 사용하여 불필요한 블로킹을 방지
  * 외부 스타일시트를 가져올 때는 **@import** 사용을 지양 -> 브라우저 스타일시트를 병렬로 다운로드할 수 없기 때문
  * 때에 따라 내부 스타일시트를 사용

* 자바스크립트 최적화 : `<script>` 태그를 만나면 스크립트 실행이 완료될 때까지 DOM 트리 생성이 중단 -> 이를 방지하기 위해 최적화를 시도
  * HTML 문서 최하단의 `</body>` 직전에 배치
  * `<head>` `<html>` 내부에 포함될 경우 **defer, async** 속성을 명시

<br>

#### 리소스 요청 수 줄이기

서버 요청 후 다운로드되어야만 사용 가능한 리소스 파일의 경우, 파일 하나 요청하는 데 많은 시간이 소요되므로, 필요한 요청만 할 수 있도록 최적화해야 한다.

* 이미지 스프라이트 : 아이콘 이미지의 경우, 하나의 파일에 묶어서 background-position 속성을 사용
* CSS, 자바스크립트 번들하기 : webpack 같은 번들러를 사용하여 CSS, 자바스크립트 파일 요청을 줄이기
* 내부 스타일시트 사용하기 : `<link>` 태그로 외부 스타일시트를 가져오는 대신, 문서 안에서 `<style>` 태그를 사용
* 작은 이미지를 HTML, CSS로 대체 : Data URI를 통해 외부 경로로 이미지를 가져오던 부분을 Base64로 변환된 URI로 대체
* 리소스 용량 줄이기
* 중복 코드 제거하기
* 만능 유틸 사용 주의하기 : lodash와 같은 라이브러리를 사용할 때, 필요한 함수만 부분적으로 가져오도록 함
* HTML 마크업 최적화 : HTML 중첩을 최소화하고, 공백, 주석 등을 제거 
* 간결한 CSS 선택자 사용 
* 압축(Minify)하여 사용하기 : webpack 플러그인으로 HTML, 자바스크립트, CSS를 모두 압축하고, 주석, 공백을 제거한 후 난독화

<br><br>

### 2. 웹페이지 렌더링 최적화

#### 레이아웃 최적화 

자바스크립트 실행 과정과 렌더링이 다시 일어나는 과정에서 레이아웃에 걸리는 시간을 단축하고, 레이아웃이 최대한 발생하지 않도록 함
  
* 자바스크립트 실행 최적화 : DOM 및 스타일 변경을 최소화
* 강제 동기 레이아웃 최적화 : 강제 동기 레이아웃을 최소화
* 가능한 한 하위 노드의 DOM을 조작하고 스타일 변경
* 영향받는 엘리먼트 제한 : DOM과 스타일을 변경할 때, 레이아웃 과정에서 주변 엘리먼트도 영향을 받으므로, 변경 범위를 최소화
* 숨겨진 엘리먼트 수정 : `display:none` 스타일을 가지고 있으면 DOM 조작과 스타일을 변경하더라도 레이아웃, 리페인트가 발생하지 않음 

<br>

#### HTML, CSS 최적화

* CSS 규칙 수 최소화
* DOM 깊이 최소화
* 애니메이션 최적화: 브라우저 프레임 속도인 60fps에 맞추어 애니메이션을 실행할 수 있도록 도와주는 requestAnimationFrame() 사용, CSS 애니메이션 사용
     > **애니메이션 최적화 시 주의점**  
     > 
     > 한 프레임이 60fps 내로 완료되어야 렌더링 시 끊기는 현상 없이 자연스러운 렌더링      
     > 네이티브 자바스크립트 API를 사용하는 것보다 CSS 사용    
     > 애니메이션을 실행할 때는 엘리먼트 레이어로 분리할 수 있도록 transform을 사용하거나, position 속성을 absolute, fixed 처리하여 최적화  
