# 코어 자바스크립트

## 클로저 (Closure)

### 의미

에워싸여져 함께 묶여진 함수  
둘러쌓인 LexicalEnvironment의 참조  

=> **내부 함수와 외부 함수의 LexicalEnvironment와의 조합**

클로저는 함수가 생성될 때 매번 같이 발생

어떤 함수에서 선언한 변수(지역 변수)를 참조하는 함수의 내부 함수에서만 발생하는 현상   
내부 함수를 **외부로 전달**할 경우, 어떤 함수의 LexicalEnvironment가 가비지 컬렉팅 되지 않는 현상

#### 외부로 전달

1. 지역 변수를 참조하는 내부 함수 자체를 return 하는 경우 
2. 콜백으로 전달하는 경우 
   1. Web API 메소드(setTimeout, setInterval 등)에 전달할 콜백 함수의 내부에서 지역 변수를 참조하는 경우
   2. DOM의 메소드(addEventListener 등)에 등록할 handler 함수 내부에서 지역 변수를 참조하는 경우

![](../Images/클로저_의미.png)

<br><br>

### 메모리 관리 

메모리 소모는 클로저의 본질적 특성 => 제대로 이해하고 잘 활용하도록 노력해야 함  
개발자가 의도적으로 참조 카운트를 0으로 만들지 않은 경우는 `메모리 누수`가 아님  

메모리를 관리하려면, 지역 변수를 참조할 필요성이 사라진 시점에서 참조 카운트를 0으로 만들기  
=> **식별자에 기본형 데이터(null 또는 undefined)를 할당**

⚠️ 2019년 기준 크롬, Node.js 등에서 사용 중인 V8 엔진의 경우, 
내부 함수에서 실제로 사용하는 변수만 남겨두고 나머지는 가비지 컬렉팅 하도록 최적화 되어있음 

<br><br>

### 예제

![](../Images/클로저_예제1.png)

![](../Images/클로저_예제2.png)

<br><br>

### 정리

![](../Images/클로저_핵심.png)

지역변수가 함수 종료 후에도 사라지지 않게 할 수 있음  
(사용자가 선택적으로 어떤 것은 사라지게, 어떤 것은 사라지지 않게 할 수 있음)

=> **⭐️ 함수 종료 후에도 사라지지 않는 지역변수를 만들 수 있음**
클로저의 가장 큰 이점

<br>

![](../Images/클로저_예제3.png)

![](../Images/클로저_핵심개념1.png)

![](../Images/클로저_핵심개념2.png)

<br><br>

## 참고 사이트 

> https://ko.javascript.info/closure
